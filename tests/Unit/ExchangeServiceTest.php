<?php

namespace Tests\Unit;

use App\Services\ExchangeRatesProvider;
use App\Services\ExchangeService;
use Illuminate\Support\Facades\App;
use Illuminate\Support\Facades\Http;
use Tests\TestCase;

class ExchangeServiceTest extends TestCase
{
    protected function setUp(): void
    {
        parent::setUp();

        Http::fake([
            'https://api.exchangeratesapi.io/latest' => Http::response([
                "success" => true,
                "timestamp" => 1724181244,
                "base" => "EUR",
                "date" => "2024-08-20",
                "rates" => [
                    "AED" => 4.085312,
                    "AFN" => 78.969471,
                    "ALL" => 99.83609,
                    "AMD" => 430.502885,
                    "ANG" => 1.999636,
                    "AOA" => 989.347767,
                    "ARS" => 1049.689679,
                    "AUD" => 1.648822,
                    "AWG" => 2.003448,
                    "AZN" => 1.889259,
                    "BAM" => 1.958105,
                    "BBD" => 2.240217,
                    "BDT" => 132.369385,
                    "BGN" => 1.956895,
                    "BHD" => 0.419111,
                    "BIF" => 3199.399383,
                    "BMD" => 1.112254,
                    "BND" => 1.451408,
                    "BOB" => 7.666473,
                    "BRL" => 6.085587,
                    "BSD" => 1.109456,
                    "BTC" => 1.8758356e-5,
                    "BTN" => 92.969344,
                    "BWP" => 14.773124,
                    "BYN" => 3.630974,
                    "BYR" => 21800.183522,
                    "BZD" => 2.236332,
                    "CAD" => 1.515168,
                    "CDF" => 3197.730973,
                    "CHF" => 0.95142,
                    "CLF" => 0.037241,
                    "CLP" => 1027.589823,
                    "CNY" => 7.933432,
                    "CNH" => 7.917732,
                    "COP" => 4462.920224,
                    "CRC" => 575.030353,
                    "CUC" => 1.112254,
                    "CUP" => 29.474738,
                    "CVE" => 110.781548,
                    "CZK" => 25.129824,
                    "DJF" => 197.669802,
                    "DKK" => 7.461724,
                    "DOP" => 66.596188,
                    "DZD" => 148.909396,
                    "EGP" => 54.387475,
                    "ERN" => 16.683814,
                    "ETB" => 121.679285,
                    "EUR" => 1,
                    "FJD" => 2.499625,
                    "FKP" => 0.865913,
                    "GBP" => 0.853494,
                    "GEL" => 2.991734,
                    "GGP" => 0.865913,
                    "GHS" => 17.384165,
                    "GIP" => 0.865913,
                    "GMD" => 77.857508,
                    "GNF" => 9598.754064,
                    "GTQ" => 8.592037,
                    "GYD" => 232.080668,
                    "HKD" => 8.662909,
                    "HNL" => 27.656227,
                    "HRK" => 7.639061,
                    "HTG" => 146.18339,
                    "HUF" => 392.888186,
                    "IDR" => 17180.268609,
                    "ILS" => 4.110692,
                    "IMP" => 0.865913,
                    "INR" => 93.174263,
                    "IQD" => 1457.053082,
                    "IRR" => 46831.466155,
                    "ISK" => 152.07866,
                    "JEP" => 0.865913,
                    "JMD" => 174.195049,
                    "JOD" => 0.788249,
                    "JPY" => 161.727341,
                    "KES" => 143.481152,
                    "KGS" => 95.289712,
                    "KHR" => 4560.24261,
                    "KMF" => 492.451194,
                    "KPW" => 1001.028746,
                    "KRW" => 1478.452866,
                    "KWD" => 0.339838,
                    "KYD" => 0.924588,
                    "KZT" => 528.483582,
                    "LAK" => 24608.625698,
                    "LBP" => 99657.982164,
                    "LKR" => 332.351219,
                    "LRD" => 217.306699,
                    "LSL" => 19.842834,
                    "LTL" => 3.284198,
                    "LVL" => 0.672792,
                    "LYD" => 5.305468,
                    "MAD" => 10.78219,
                    "MDL" => 19.481531,
                    "MGA" => 5121.930479,
                    "MKD" => 61.585312,
                    "MMK" => 3612.558454,
                    "MNT" => 3779.439321,
                    "MOP" => 8.902599,
                    "MRU" => 42.610713,
                    "MUR" => 51.352829,
                    "MVR" => 17.139474,
                    "MWK" => 1930.325849,
                    "MXN" => 21.113522,
                    "MYR" => 4.868896,
                    "MZN" => 71.073037,
                    "NAD" => 19.84279,
                    "NGN" => 1751.800796,
                    "NIO" => 40.986221,
                    "NOK" => 11.672235,
                    "NPR" => 148.736383,
                    "NZD" => 1.807263,
                    "OMR" => 0.428173,
                    "PAB" => 1.109446,
                    "PEN" => 4.166783,
                    "PGK" => 2.772626,
                    "PHP" => 62.653842,
                    "PKR" => 309.846217,
                    "PLN" => 4.274917,
                    "PYG" => 8418.303894,
                    "QAR" => 4.04944,
                    "RON" => 4.977452,
                    "RSD" => 117.041398,
                    "RUB" => 101.38151,
                    "RWF" => 1464.838862,
                    "SAR" => 4.173486,
                    "SBD" => 9.467537,
                    "SCR" => 14.827433,
                    "SDG" => 669.015001,
                    "SEK" => 11.345066,
                    "SGD" => 1.451508,
                    "SHP" => 0.865913,
                    "SLE" => 25.41201,
                    "SLL" => 23323.380363,
                    "SOS" => 635.097238,
                    "SRD" => 32.137506,
                    "STD" => 23021.417577,
                    "SVC" => 9.707991,
                    "SYP" => 2794.572415,
                    "SZL" => 80.543847,
                    "THB" => 38.005603,
                    "TJS" => 11.815677,
                    "TMT" => 3.904012,
                    "TND" => 3.393512,
                    "TOP" => 2.619696,
                    "TRY" => 37.69774,
                    "TTD" => 7.520447,
                    "TWD" => 35.479786,
                    "TZS" => 3006.495743,
                    "UAH" => 45.906838,
                    "UGX" => 4130.63945,
                    "USD" => 1.112254,
                    "UYU" => 44.762691,
                    "UZS" => 14058.893972,
                    "VEF" => 4029199.493295,
                    "VES" => 40.753763,
                    "VND" => 27722.937464,
                    "VUV" => 132.049026,
                    "WST" => 3.115338,
                    "XAF" => 656.694586,
                    "XAG" => 0.037743,
                    "XAU" => 0.000443,
                    "XCD" => 3.005923,
                    "XDR" => 0.829569,
                    "XOF" => 667.909813,
                    "XPF" => 119.331742,
                    "YER" => 278.48067,
                    "ZAR" => 19.82799,
                    "ZMK" => 10011.631711,
                    "ZMW" => 28.596119,
                    "ZWL" => 358.145418
                ],
            ], 200),
        ]);
    }

    public function testExchangeAEDToEur(): void
    {
        $service = new ExchangeService(App::make(ExchangeRatesProvider::class));

        $res = $service->convertToEur(4.085312, 'AED');

        $this->assertEquals(round($res, 2), 1);
    }

    public function testExchangeEurToEur(): void
    {
        $service = new ExchangeService(App::make(ExchangeRatesProvider::class));

        $res = $service->convertToEur(4.085312, 'EUR');

        $this->assertEquals($res, 4.085312);
    }
}
